{% load i18n admin_urls placeholder_admin_tags %}{% comment %}
  This is the admin template to render the PlaceholderFieldInline.

  It includes the placeholder inline fields, and initialisation code,
  so the placeholder editor can do it's work. The 'domnode' div elements
  are generated by the PlaceholderFieldWidget instances in the form.
{% endcomment %}
<script type="text/javascript">
  // Pass database data to the cp_admin.js file.
  // Each tab hosts a placeholder pane.
  cp_data.set_placeholders({% block js_placeholders %}[ {% for form in inline_admin_formset.formset.forms %}{% with placeholder=form.instance %}{% if not forloop.first %}, {% endif %}
    {
      id: {% if placeholder and placeholder.id %}{{ placeholder.id }}{% else %}''{% endif %},{# if test added to support TEMPLATE_STRING_IF_INVALID #}
      slot: '{{ form.slot.value|default:forloop.counter0|escapejs }}',
      title: '{{ form.title.value|default:"?"|escapejs }}',
      role: '{{ form.role.value|default:'?' }}',
      domnode: 'cp-placeholderfield-{{ form.slot.value|default:forloop.counter0|slugify }}'
    }{% endwith %}{% endfor %}
  ]{% endblock %});
  cp_data.set_contentitem_metadata({% with parent_formset=inline_admin_formsets|get_content_item_formset %}{
    prefix: '{{ parent_formset.prefix|escapejs }}',{# fs.formset = targetobjectformFormSet #}
    auto_id: '{{ parent_formset.auto_id|escapejs }}',
    child_inlines: {% block js_contentitemtypes %}{{% for child_inline in inline_admin_formsets|all_content_item_child_inlines %}
      '{{ child_inline.type_name|escapejs }}': {
        type: '{{ child_inline.type_name|escapejs }}',
        plugin: '{{ child_inline.plugin.name|escapejs }}',
        name: '{{ child_inline.name|escapejs }}',
        contenttype_id: {{ child_inline.content_type.pk }}
      }{% if not forloop.last %}, {% endif %}{% endfor %}
    }{% endblock %}
  });{% endwith %}
</script>

<div id="{{ inline_admin_formset.formset.prefix }}-group"
     class="inline-group inline-placeholder-group" style="display: none;"{% if original %}
     data-get-placeholder-data-url="{% url opts|admin_urlname:'get_placeholder_data' original.pk %}"{% endif %}>
  {{ inline_admin_formset.formset.management_form }}
  {{ inline_admin_formset.formset.non_form_errors }}

  {# all the region tabs #}
  {% for inline_admin_form in inline_admin_formset %}
    {% if inline_admin_form.form.errors %}{# Should never happen, but when it does, this aids debugging #}
      <ul class="errorlist"><li>{{ inline_admin_form.form.errors.as_text|linebreaksbr }}</li></ul>
    {% endif %}

    <!-- placeholder fields -->
    {% if inline_admin_form.has_auto_field or inline_admin_form.needs_explicit_pk_field %}{{ inline_admin_form.pk_field.field }}{% endif %}
    {{ inline_admin_form.fk_field.field }}

    {% for fieldset in inline_admin_form %}{% for line in fieldset %}{% for adminfield in line %}{{ adminfield.field.as_hidden }}
    {% endfor %}{% endfor %}{% endfor %}

  {% endfor %}
</div>
